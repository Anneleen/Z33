<!DOCTYPE html> 
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes"/>
	
	<title>Overzicht tentoonstellingen</title>
	<link rel="stylesheet" href="themes/z33.min.css"/>
	<script type="text/javascript" src="jquery/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="jquery/jquery.mobile-1.2.0.min.js"></script>
	<script stype="text/javascript" src="phonegap.js"></script> 
	
	<script src="jquery/jquery.imagesloaded.min.js"></script>
	<script src="jquery/imgcache.js"></script>
	
	<script>
		var startTest = function() {
			$('body').imagesLoaded(function($images, $proper, $broken ) {

				// see console output for debug info
				ImgCache.options.debug = true;
				ImgCache.options.usePersistentCache = true;
	
				ImgCache.init(function() {
					// 1. cache images
					for (var i = 0; i < $proper.length; i++) {
						ImgCache.cacheFile($($proper[i]).attr('src'));
					}
					// 2. broken images get replaced
					for (var i = 0; i < $broken.length; i++) {
						ImgCache.useCachedFile($($broken[i]));
					}

				});
			});
		};

		if (typeof(cordova) !== 'undefined') {
			// cordova test
			document.addEventListener('deviceready', startTest, false);
		} else {
			// normal browser test
			$(document).ready(startTest);
		}
	</script>
	
	<link rel="stylesheet" href="themes/responsiveslide.css">
	<script type="text/javascript" src="jquery/responsiveslides.min.js"></script>
	
<script type="text/javascript" charset="utf-8">
//Global instance of DirectoryEntry for our data
var DATADIR;
var knownfiles = [];    

//Loaded my file system, now let's get a directory entry for where I'll store my crap    
function onFSSuccess(fileSystem) {
    fileSystem.root.getDirectory("Android/data/be.z33.mobile",{create:true},gotDir,onError);
}

//The directory entry callback
function gotDir(d){
    console.log("got dir");
    DATADIR = d;
    var reader = DATADIR.createReader();
    reader.readEntries(function(d){
        gotFiles(d);
        appReady();
    },onError);
}

//Result of reading my directory
function gotFiles(entries) {
    console.log("The dir has "+entries.length+" entries.");
for (var i=0; i<entries.length; i++) {
console.log(entries[i].name+' dir? '+entries[i].isDirectory);
        knownfiles.push(entries[i].name);
}
}

function onError(e){
    console.log("ERROR");
    console.log(JSON.stringify(e));
}

function onDeviceReady() {
    //what do we have in cache already?
    $("#status").html("Checking your local cache....");    
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, null);  
}

function appReady(){
    $("#status").html("Ready to check remote files...");
    $.get("http://mllsdemode.be/Z33/download.json", {}, function(res) {
        if (res.length > 0) {
            $("#status").html("Going to sync some images...");
            for (var i = 0; i < res.length; i++) {
                    console.log("need to download " + res[i]);
                    var ft = new FileTransfer();
                    var dlPath = DATADIR.fullPath + "/" + res[i];
console.log("downloading crap to " + dlPath);
ft.download("http://mllsdemode.be/Z33/" + escape(res[i]), dlPath, function(e){
console.log("Successful download of "+e.fullPath);
}, onError);
               
            }
        }
        $("#status").html("");
    }, "json");

}

function init() {
document.addEventListener("deviceready", onDeviceReady, true);
}
</script>

<script>
var delay = 6000;
window.setTimeout(function() {
    window.location = "index_nl.html";
}, 5000);
</script>

</head> 
<body onload="init();"> 
<div data-role="page">

<div data-theme="a">

	<div data-role="header" class="ui-header ui-bar-a" role="banner" data-position="fixed" data-tap-toggle="false">
	<div class="hd">
		<a href="tst.html" data-ajax="false" title="Z33" class="Z33"><span style="display:none;" data-position="fixed">Z33</span></a>
	</div>
	</div><!-- /header -->

	<div data-theme="a" data-role="content">
	</div><!-- /content -->
	
</div><!-- /page -->
</div>
</body>
</html>